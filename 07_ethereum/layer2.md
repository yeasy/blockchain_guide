# Layer 2 与扩容方案

随着以太坊生态的爆发式增长，主网（Layer 1）的性能瓶颈日益凸显。高昂的 Gas 费用和低下的交易吞吐量（TPS 仅约 15-30）成为了阻碍区块链大规模应用的主要障碍。为了解决这一难题，社区提出了 Layer 2 扩容方案。

Layer 2 指的是构建在以太坊主网之上的通过智能合约连接的独立区块链网络。它们将计算和数据处理转移到链下（Off-Chain）进行，仅将最终结果和关键数据打包上传回主网进行验证和结算。这既继承了以太坊主网的安全性，又极大地提升了系统的处理能力并降低了交易成本。

## Layer 2 的核心技术：Rollups

在经历了状态通道（State Channels）、侧链（Sidechains）和 Plasma 等早期尝试后，Rollups 已成为目前最主流且被以太坊路线图确认为核心的扩容方案。

Rollups（汇总）的核心思想是将数百笔交易在 Layer 2 上执行和压缩，然后打包成一笔交易提交到 Layer 1。根据验证数据的不同方式，Rollups 分为两大流派。

### Optimistic Rollups（乐观汇总）

*   **原理**：默认假设提交到 Layer 1 的数据是正确的（乐观态度）。如果不正确，网络中的验证者可以在“挑战期”（通常为 7 天）内发起欺诈证明（Fraud Proof）。如果没有人在挑战期内提出异议，交易即被视为最终确认。
*   **优点**：兼容性好，由于兼容以太坊虚拟机（EVM），现有的 DApp 可以几乎无缝迁移。
*   **缺点**：提款到 Layer 1 需要等待数天的挑战期。
*   **代表项目**：**Arbitrum**、**Optimism**。

### ZK Rollups（零知识汇总）

*   **原理**：利用零知识证明（Zero-Knowledge Proofs）技术。Layer 2 在打包交易时，会生成一个数学证明（Validity Proof），证明这些交易是有效且状态转换是正确的。Layer 1 的智能合约只需验证这个证明即可。
*   **优点**：安全性更高，完全依赖数学而非博弈；提款无需等待，一旦证明被 Layer 1 验证通过即可。
*   **缺点**：计算生成零知识证明需要消耗大量算力；早期的 EVM 兼容性较差（zkEVM 正在快速发展中）。
*   **代表项目**：**zkSync**、**Starknet**、**Polygon zkEVM**、**Scroll**。

## 关键升级：EIP-4844 与 Blob

2024 年 3 月实施的 Dencun 升级引入了 **EIP-4844 (Proto-Danksharding)**，这是 Layer 2 发展史上的里程碑。

在 EIP-4844 之前，Layer 2 需要将交易数据作为 `calldata` 存储在以太坊 Layer 1 上，这占用了昂贵的区块空间且永久存储，导致 Layer 2 的费用虽然比 Layer 1 低，但仍不够便宜。

EIP-4844 引入了一种新的数据格式 —— **Blob (Binary Large Object)**。
*   **临时存储**：Blob 数据不像 `calldata` 那样被永久存储在历史记录中，而是由共识节点保存约 18 天（4096 个 Epoch），之后便会被修剪。这对于 Layer 2 验证交易的有效性已经足够。
*   **独立市场**：Blob 拥有独立的费用拍卖市场，不与普通的转账交易竞争 Gas，因此价格极其低廉。

EIP-4844 上线后，主流 Layer 2 网络的交易费用下降了 90% 以上，许多交易的成本降至 0.01 美元以下，为社交、游戏等高频应用铺平了道路。



## 总结

Layer 2 已经成为以太坊生态的重要组成部分。随着技术的发展，"Layer 2 负责执行，Layer 1 负责结算和数据可用性" 这一模块化区块链（Modular Blockchain）的架构已成为行业共识。未来，我们可能会看到 Layer 3 (L3) 的出现，进一步为特定应用场景提供定制化的扩容服务。
